# ğŸ“Š DIAGRAMAS VISUAIS - SISTEMA DE FILA

## 1. ARQUITETURA DO SISTEMA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CAMADA DE APRESENTAÃ‡ÃƒO                    â”‚
â”‚                   (React + Inertia + Tailwind)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Dashboard  â”‚  â”‚   Pacientes  â”‚  â”‚    Fila      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Triagem   â”‚  â”‚  ServiÃ§os    â”‚  â”‚  Atendimento â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP/HTTPS
                               â”‚ JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CAMADA DE API (REST)                          â”‚
â”‚                        Laravel 12                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes (DefiniÃ§Ã£o de endpoints)                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Controllers (LÃ³gica de negÃ³cio)                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ AuthController                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ PatientController                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ QueueController                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ TriageController                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ ServiceController                                    â”‚  â”‚
â”‚  â”‚  â””â”€ DashboardController                                  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Middleware (SeguranÃ§a)                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ ApiAuth (AutenticaÃ§Ã£o)                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ EnsureUserIsAdmin                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ EnsureUserIsTriagist                                 â”‚  â”‚
â”‚  â”‚  â””â”€ EnsureUserIsDoctor                                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Models (Dados)                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ User                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Patient                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ QueueEntry                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Triage                                               â”‚  â”‚
â”‚  â”‚  â””â”€ Service                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CAMADA DE DADOS                               â”‚
â”‚            MySQL/PostgreSQL Database                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  users | patients | services | triages | queue_entries  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. FLUXO DE AUTENTICAÃ‡ÃƒO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UsuÃ¡rio   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/register
       â”‚ (email, password, function)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthController      â”‚
â”‚  register()          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Valida dados
       â”‚ Hash password
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User::create()      â”‚
â”‚  â”œâ”€ name             â”‚
â”‚  â”œâ”€ email            â”‚
â”‚  â”œâ”€ password_hash    â”‚
â”‚  â””â”€ function         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Cria token
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Retorna JSON com:                   â”‚
â”‚  â”œâ”€ token                            â”‚
â”‚  â”œâ”€ user                             â”‚
â”‚  â””â”€ redirect_url                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UsuÃ¡rio   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/login
       â”‚ (email, password)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthController      â”‚
â”‚  login()             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Auth::attempt()
       â”‚ Valida credenciais
       â”‚
       â”œâ”€ âŒ Falha â†’ 401 Unauthorized
       â”‚
       â”œâ”€ âœ… Sucesso
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gera Token Sanctum  â”‚
â”‚  createToken()       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Retorna JSON com:                   â”‚
â”‚  â”œâ”€ token                            â”‚
â”‚  â”œâ”€ user                             â”‚
â”‚  â””â”€ redirect_url                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RequisiÃ§Ãµes subsequentes             â”‚
â”‚ Header: Authorization: Bearer {token}â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sanctum Middleware  â”‚
â”‚  Valida token        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ âŒ Token invÃ¡lido/expirado â†’ 401
       â”‚
       â”œâ”€ âœ… Token vÃ¡lido
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RequisiÃ§Ã£o prossegue autenticada     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. FLUXO COMPLETO DE ATENDIMENTO

```
HORA:  08h00                  09h00                   10h00
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

ESTADO:
       PACIENTE CHEGA         ATENDIMENTO             FINALIZADO


1. PACIENTE CHEGA
   â”œâ”€ 08h15 â†’ Triagista registra paciente
   â”‚         POST /api/patients
   â”‚         â””â”€ Cria registro em "patients"
   â”‚            â””â”€ created_by = triagista_id
   â”‚
   â”œâ”€ 08h20 â†’ Triagista faz triagem
   â”‚         POST /api/triage
   â”‚         â”œâ”€ Cria registro em "triages"
   â”‚         â”‚  â””â”€ score = 3 (prioridade)
   â”‚         â”‚
   â”‚         â””â”€ Cria QueueEntry
   â”‚            â”œâ”€ patient_id = 1
   â”‚            â”œâ”€ service_id = 2 (Cardiologia)
   â”‚            â”œâ”€ priority = 3 (mesmo que score)
   â”‚            â”œâ”€ status = "waiting"
   â”‚            â”œâ”€ created_by = triagista_id
   â”‚            â””â”€ arrived_at = 2025-11-11 08:20


2. PACIENTE NA FILA
   â”œâ”€ 08h30 â†’ MÃ©dico vÃª fila
   â”‚         GET /api/queue
   â”‚         Retorna: [Patient 1, Patient 2, Patient 3...]
   â”‚
   â”œâ”€ 08h35 â†’ MÃ©dico chama paciente
   â”‚         POST /api/queue/1/call
   â”‚         Atualiza QueueEntry:
   â”‚         â”œâ”€ status = "called"
   â”‚         â””â”€ called_at = 2025-11-11 08:35


3. ATENDIMENTO INICIADO
   â”œâ”€ 08h40 â†’ MÃ©dico inicia atendimento
   â”‚         POST /api/queue/1/start
   â”‚         Atualiza QueueEntry:
   â”‚         â”œâ”€ status = "in_service"
   â”‚         â””â”€ started_at = 2025-11-11 08:40


4. ATENDIMENTO FINALIZADO
   â”œâ”€ 09h00 â†’ MÃ©dico finaliza
   â”‚         POST /api/queue/1/finish
   â”‚         Atualiza QueueEntry:
   â”‚         â”œâ”€ status = "finished"
   â”‚         â””â”€ finished_at = 2025-11-11 09:00


5. ESTATÃSTICAS
   â”œâ”€ Tempo na fila: 09:00 - 08:20 = 40 minutos
   â”œâ”€ Tempo em atendimento: 09:00 - 08:40 = 20 minutos
   â””â”€ Tempo total: 45 minutos
```

---

## 4. ESTRUTURA DE ROLES E PERMISSÃ•ES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADMIN                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PermissÃµes:                                                     â”‚
â”‚ âœ… Ver todos os dashboards                                     â”‚
â”‚ âœ… Criar/editar/deletar serviÃ§os                               â”‚
â”‚ âœ… Criar usuÃ¡rios (admin, triagist, doctor)                    â”‚
â”‚ âœ… Ver relatÃ³rios completos                                    â”‚
â”‚ âœ… Acessar todas as funcionalidades                            â”‚
â”‚                                                                 â”‚
â”‚ Fluxo de RequisiÃ§Ã£o:                                            â”‚
â”‚ 1. Envia token com role="admin"                                â”‚
â”‚ 2. Middleware EnsureUserIsAdmin valida                         â”‚
â”‚ 3. Request prossegue com acesso total                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TRIAGIST                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PermissÃµes:                                                     â”‚
â”‚ âœ… Registrar novos pacientes                                   â”‚
â”‚ âœ… Editar dados de pacientes                                   â”‚
â”‚ âœ… Fazer avaliaÃ§Ã£o de triagem                                  â”‚
â”‚ âœ… Adicionar pacientes na fila                                 â”‚
â”‚ âœ… Cancelar pacientes da fila                                  â”‚
â”‚ âœ… Ver fila de triagem                                         â”‚
â”‚ âŒ Iniciar/finalizar atendimento (apenas mÃ©dicos)              â”‚
â”‚ âŒ Deletar pacientes (apenas admin)                            â”‚
â”‚ âŒ Gerenciar serviÃ§os (apenas admin)                           â”‚
â”‚                                                                 â”‚
â”‚ Fluxo de RequisiÃ§Ã£o:                                            â”‚
â”‚ 1. Envia token com role="triagist"                             â”‚
â”‚ 2. Middleware EnsureUserIsTriagist valida                      â”‚
â”‚ 3. Request prossegue com acesso limitado                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOCTOR                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PermissÃµes:                                                     â”‚
â”‚ âœ… Ver fila do seu serviÃ§o                                     â”‚
â”‚ âœ… Chamar pacientes                                            â”‚
â”‚ âœ… Iniciar atendimento                                         â”‚
â”‚ âœ… Finalizar atendimento                                       â”‚
â”‚ âœ… Ver prÃ³ximo paciente                                        â”‚
â”‚ âœ… Ver dados bÃ¡sicos do paciente                               â”‚
â”‚ âŒ Registrar pacientes (apenas triagistas)                     â”‚
â”‚ âŒ Fazer triagem (apenas triagistas)                           â”‚
â”‚ âŒ Gerenciar serviÃ§os (apenas admin)                           â”‚
â”‚                                                                 â”‚
â”‚ Fluxo de RequisiÃ§Ã£o:                                            â”‚
â”‚ 1. Envia token com role="doctor"                               â”‚
â”‚ 2. Middleware EnsureUserIsDoctor valida                        â”‚
â”‚ 3. Request prossegue com acesso limitado                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. MODELO DE DADOS RELACIONADO

```
User (UsuÃ¡rio)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id (PK)            â”‚
â”‚ name               â”‚
â”‚ email (UNIQUE)     â”‚
â”‚ password           â”‚
â”‚ function (ENUM) â—„â”€â”€â”¼â”€ admin, triagist, doctor
â”‚ created_at         â”‚
â”‚ updated_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â–²      â–²      â–²
      â”‚      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚      â”‚                     â”‚
      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
      â”‚                 â”‚          â”‚
      â”‚        Triage   â”‚      QueueEntry
      â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚        â”‚ triagist_id â”€â”€â”¤   â”‚ created_by â”€â”€â”¤
      â”‚        â”‚ (FK)          â”‚   â”‚ (FK)         â”‚
      â”‚        â”‚               â”‚   â”‚              â”‚
      â”‚        â”‚ patient_id â”€â”€â”€â”¼â”€â”€â–ºPatient       â”‚
      â”‚        â”‚ (FK)          â”‚   â”‚ id (PK)     â”‚
      â”‚        â”‚               â”‚   â”‚ name         â”‚
      â”‚        â”‚ score (1-5)   â”‚   â”‚ birth_date  â”‚
      â”‚        â”‚ notes         â”‚   â”‚ document    â”‚
      â”‚        â”‚ created_at    â”‚   â”‚ phone       â”‚
      â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ created_by â”€â”¤
      â”‚                            â”‚ (FK) â—„â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€ User
      â”‚                            â”‚              â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                                    Service
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ id (PK)          â”‚
                    QueueEntry â”€â”€â”€â”€â”¤ service_id (FK)  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ name             â”‚
                    â”‚ service_id â”€â”¤â–ºâ”‚ avg_service_time â”‚
                    â”‚ (FK)        â”‚ â”‚ created_at       â”‚
                    â”‚             â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ patient_id â”€â”¼â”€â”€â–º Patient
                    â”‚ status (ENUM)â”‚
                    â”‚ priority     â”‚
                    â”‚ arrived_at   â”‚
                    â”‚ called_at    â”‚
                    â”‚ started_at   â”‚
                    â”‚ finished_at  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. SEQUÃŠNCIA DE CHAMADAS API (Caso Real)

```
HorÃ¡rio: 08:00 - Triagista comeÃ§a dia

08:15 â†’ POST /api/register
        {
          "name": "Maria Silva",
          "email": "maria@clinica.com",
          "password": "senha123",
          "function": "triagist"
        }
        Response 201: {token, user}

08:20 â†’ POST /api/patients
        Headers: Authorization: Bearer {token}
        {
          "name": "JoÃ£o Santos",
          "birth_date": "1985-05-15",
          "document": "12345678900",
          "phone": "11988887777"
        }
        Response 201: {id: 1, name: "JoÃ£o Santos", created_by: 2}

08:25 â†’ GET /api/services
        Headers: Authorization: Bearer {token}
        Response 200: [
          {id: 1, name: "Cardiologia"},
          {id: 2, name: "Ortopedia"},
          {id: 3, name: "Pediatria"}
        ]

08:30 â†’ POST /api/triage
        Headers: Authorization: Bearer {token}
        {
          "patient_id": 1,
          "service_id": 1,
          "score": 3,
          "notes": "Paciente com dor no peito"
        }
        Response 201: {id: 1, patient_id: 1, score: 3, triagist_id: 2}

        â†’ Simultaneamente cria QueueEntry:
          {
            patient_id: 1,
            service_id: 1,
            status: "waiting",
            priority: 3,
            created_by: 2,
            arrived_at: 2025-11-11 08:30
          }

08:45 â†’ POST /api/login (MÃ©dico)
        {
          "email": "dr.carlos@clinica.com",
          "password": "senha123"
        }
        Response 200: {token, user, redirect: "/dashboard/doctor"}

08:50 â†’ GET /api/queue/next?service_id=1
        Headers: Authorization: Bearer {token_medico}
        Response 200: {
          id: 1,
          patient: {name: "JoÃ£o Santos"},
          service: {name: "Cardiologia"},
          priority: 3,
          score: 3
        }

08:55 â†’ POST /api/queue/1/call
        Headers: Authorization: Bearer {token_medico}
        Response 200: {
          status: "called",
          called_at: 2025-11-11 08:55
        }

09:00 â†’ POST /api/queue/1/start
        Headers: Authorization: Bearer {token_medico}
        Response 200: {
          status: "in_service",
          started_at: 2025-11-11 09:00
        }

09:20 â†’ POST /api/queue/1/finish
        Headers: Authorization: Bearer {token_medico}
        Response 200: {
          status: "finished",
          finished_at: 2025-11-11 09:20
        }

09:25 â†’ GET /api/dashboard/summary
        Headers: Authorization: Bearer {token_admin}
        Response 200: {
          total_patients_today: 15,
          patients_in_queue: 12,
          patients_in_service: 2,
          patients_finished: 3,
          avg_wait_time: 35.5,
          avg_service_time: 22.3
        }
```

---

## 7. MATRIZ DE PERMISSÃ•ES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AÃ§Ã£o               â”‚ Admin  â”‚ Triagist â”‚ Doctor â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Registrar usuÃ¡rio  â”‚ âœ…     â”‚ âŒ       â”‚ âŒ     â”‚
â”‚ Ver usuÃ¡rios       â”‚ âœ…     â”‚ âŒ       â”‚ âŒ     â”‚
â”‚ Criar paciente     â”‚ âœ…     â”‚ âœ…       â”‚ âŒ     â”‚
â”‚ Editar paciente    â”‚ âœ…     â”‚ âœ…       â”‚ âŒ     â”‚
â”‚ Deletar paciente   â”‚ âœ…     â”‚ âŒ       â”‚ âŒ     â”‚
â”‚ Ver paciente       â”‚ âœ…     â”‚ âœ…       â”‚ âœ…     â”‚
â”‚ Fazer triagem      â”‚ âœ…     â”‚ âœ…       â”‚ âŒ     â”‚
â”‚ Criar serviÃ§o      â”‚ âœ…     â”‚ âŒ       â”‚ âŒ     â”‚
â”‚ Editar serviÃ§o     â”‚ âœ…     â”‚ âŒ       â”‚ âŒ     â”‚
â”‚ Deletar serviÃ§o    â”‚ âœ…     â”‚ âŒ       â”‚ âŒ     â”‚
â”‚ Ver serviÃ§o        â”‚ âœ…     â”‚ âœ…       â”‚ âœ…     â”‚
â”‚ Ver fila           â”‚ âœ…     â”‚ âœ…       â”‚ âœ…     â”‚
â”‚ Enfileirar pacienteâ”‚ âœ…     â”‚ âœ…       â”‚ âŒ     â”‚
â”‚ Chamar paciente    â”‚ âœ…     â”‚ âŒ       â”‚ âœ…     â”‚
â”‚ Iniciar atendimentoâ”‚ âœ…     â”‚ âŒ       â”‚ âœ…     â”‚
â”‚ Finalizar atendi.  â”‚ âœ…     â”‚ âŒ       â”‚ âœ…     â”‚
â”‚ Cancelar paciente  â”‚ âœ…     â”‚ âœ…       â”‚ âŒ     â”‚
â”‚ Ver dashboard      â”‚ âœ…     â”‚ âœ…       â”‚ âœ…     â”‚
â”‚ Ver relatÃ³rios     â”‚ âœ…     â”‚ âŒ       â”‚ âŒ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagrama gerado em:** 11 de Novembro de 2025
**Para:** ApresentaÃ§Ã£o Visual do Projeto
